@tailwind base;
@tailwind components;
@tailwind utilities;

/* Pip-Boy Retro CRT Design System 
All colors MUST be HSL - Monochrome Green Theme
*/

@import url('https://fonts.googleapis.com/css2?family=VT323:wght@400&family=Share+Tech+Mono:wght@400&display=swap');

@layer base {
  :root {
    /* Dynamic Theme Hue - Will be updated by theme context */
    --theme-hue: 120; /* Default: green */
    
    /* Core CRT Color Palette (using dynamic hue) */
    --background: var(--theme-hue) 100% 3%;        /* Very dark themed-black */
    --foreground: var(--theme-hue) 100% 75%;       /* Bright terminal color */
    
    --card: var(--theme-hue) 100% 4%;              /* Slightly lighter dark color */
    --card-foreground: var(--theme-hue) 100% 70%;  /* Card text color */
    
    --popover: var(--theme-hue) 100% 5%;
    --popover-foreground: var(--theme-hue) 100% 75%;
    
    --primary: var(--theme-hue) 100% 50%;          /* Electric terminal color */
    --primary-foreground: var(--theme-hue) 100% 3%;
    
    --secondary: var(--theme-hue) 50% 15%;         /* Darker color for secondary elements */
    --secondary-foreground: var(--theme-hue) 100% 65%;
    
    --muted: var(--theme-hue) 30% 10%;             /* Muted dark color */
    --muted-foreground: var(--theme-hue) 50% 45%;  /* Muted text */
    
    --accent: var(--theme-hue) 100% 40%;           /* Accent bright color */
    --accent-foreground: var(--theme-hue) 100% 5%;
    
    --destructive: 0 100% 45%;        /* Red for errors (always red) */
    --destructive-foreground: var(--theme-hue) 100% 95%;
    
    --border: var(--theme-hue) 50% 20%;            /* Border color */
    --input: var(--theme-hue) 50% 12%;             /* Input background */
    --ring: var(--theme-hue) 100% 50%;             /* Focus ring */
    
    --radius: 0.25rem;                /* Sharp corners for retro feel */
    
    /* CRT Effects */
    --scanline-opacity: 0.1;
    --flicker-intensity: 0.98;
    --glow-size: 2px;
    
    /* Custom gradients (using dynamic hue) */
    --gradient-crt: linear-gradient(180deg, 
      hsl(var(--theme-hue) 100% 5%), 
      hsl(var(--theme-hue) 100% 3%), 
      hsl(var(--theme-hue) 100% 5%));
    --gradient-screen: radial-gradient(ellipse at center,
      hsl(var(--theme-hue) 100% 4%) 0%,
      hsl(var(--theme-hue) 100% 2%) 100%);
      
    /* Sidebar specific */
    --sidebar-background: var(--theme-hue) 100% 4%;
    --sidebar-foreground: var(--theme-hue) 100% 70%;
    --sidebar-primary: var(--theme-hue) 100% 50%;
    --sidebar-primary-foreground: var(--theme-hue) 100% 3%;
    --sidebar-accent: var(--theme-hue) 50% 15%;
    --sidebar-accent-foreground: var(--theme-hue) 100% 65%;
    --sidebar-border: var(--theme-hue) 50% 20%;
    --sidebar-ring: var(--theme-hue) 100% 50%;

    /* Animations */
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    /* Responsive Typography System */
    --text-scale-factor: clamp(0.8, 2cqw, 1.2);
    --text-xs: calc(0.75rem * var(--text-scale-factor));
    --text-sm: calc(0.875rem * var(--text-scale-factor));
    --text-base: calc(1rem * var(--text-scale-factor));
    --text-lg: calc(1.125rem * var(--text-scale-factor));
    --text-xl: calc(1.25rem * var(--text-scale-factor));
    --text-2xl: calc(1.5rem * var(--text-scale-factor));
    --text-3xl: calc(1.875rem * var(--text-scale-factor));

    /* CRT-aware line height for better readability */
    --line-height-tight: 1.1;
    --line-height-normal: 1.3;
    --line-height-relaxed: 1.5;
  }

  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground font-mono;
    overflow: hidden; /* Prevent scrollbars for immersive feel */
    /* Mobile optimizations */
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* CRT Screen Effects */
  .crt-screen {
    position: relative;
    background: var(--gradient-screen);
    overflow: hidden;
  }

  .crt-screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      hsla(var(--theme-hue), 100%, 50%, var(--scanline-opacity)) 2px,
      hsla(var(--theme-hue), 100%, 50%, var(--scanline-opacity)) 4px
    );
    pointer-events: none;
    z-index: 1000;
  }

  .crt-glow {
    text-shadow: 
      0 0 var(--glow-size) hsl(var(--primary)),
      0 0 calc(var(--glow-size) * 2) hsl(var(--primary)),
      0 0 calc(var(--glow-size) * 3) hsl(var(--primary));
  }

  /* Icon Color Utilities */
  .icon-primary {
    color: hsl(var(--primary));
  }

  .icon-secondary {
    color: hsl(var(--secondary-foreground));
  }

  .icon-accent {
    color: hsl(var(--accent));
  }

  .icon-muted {
    color: hsl(var(--muted-foreground));
  }

  .icon-destructive {
    color: hsl(var(--destructive));
  }

  /* Icon CRT Glow Effects */
  .icon-glow {
    filter: drop-shadow(0 0 var(--glow-size) currentColor) 
            drop-shadow(0 0 calc(var(--glow-size) * 2) currentColor);
  }

  /* All icons get CRT styling by default */
  svg {
    transition: all 0.2s ease;
  }

  /* Hover effects for interactive icons */
  button svg, [role="button"] svg, .cursor-pointer svg {
    transition: all 0.2s ease;
  }

  button:hover svg, [role="button"]:hover svg, .cursor-pointer:hover svg {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 1.5) currentColor);
    transform: scale(1.05);
  }

  .crt-flicker {
    animation: flicker 0.15s infinite linear alternate;
  }

  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: var(--flicker-intensity); }
  }

  /* Custom Scrollbar Styling */
  /* Webkit browsers (Chrome, Safari, Edge) */
  ::-webkit-scrollbar {
    width: 12px;
    height: 12px;
  }

  ::-webkit-scrollbar-track {
    background: hsl(var(--background));
    border: 1px solid hsl(var(--border));
    border-radius: 6px;
  }

  ::-webkit-scrollbar-thumb {
    background: hsl(var(--primary) / 0.6);
    border-radius: 6px;
    border: 2px solid hsl(var(--background));
    transition: background-color 0.2s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--primary) / 0.8);
  }

  ::-webkit-scrollbar-thumb:active {
    background: hsl(var(--primary));
  }

  ::-webkit-scrollbar-corner {
    background: hsl(var(--background));
  }

  /* Firefox scrollbar styling */
  * {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--primary) / 0.6) hsl(var(--background));
  }

  /* Custom scrollbar for specific containers with CRT theme */
  .crt-scrollbar::-webkit-scrollbar {
    width: 14px;
  }

  .crt-scrollbar::-webkit-scrollbar-track {
    background: hsl(var(--background));
    border: 1px solid hsl(var(--primary) / 0.3);
    border-radius: 0;
    box-shadow: inset 0 0 6px hsl(var(--primary) / 0.1);
  }

  .crt-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(
      180deg,
      hsl(var(--primary) / 0.8) 0%,
      hsl(var(--primary) / 0.6) 50%,
      hsl(var(--primary) / 0.8) 100%
    );
    border-radius: 0;
    border: 1px solid hsl(var(--primary) / 0.5);
    box-shadow: 
      0 0 4px hsl(var(--primary) / 0.3),
      inset 0 0 2px hsl(var(--primary) / 0.2);
  }

  .crt-scrollbar::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(
      180deg,
      hsl(var(--primary)) 0%,
      hsl(var(--primary) / 0.8) 50%,
      hsl(var(--primary)) 100%
    );
    box-shadow: 
      0 0 8px hsl(var(--primary) / 0.5),
      inset 0 0 4px hsl(var(--primary) / 0.3);
  }
  /* Boot sequence animation */
  .boot-sequence {
    animation: bootUp 2s ease-out;
  }

  @keyframes bootUp {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.9);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Mobile touch optimizations */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
    position: relative;
  }

  .mobile-nav {
    @apply touch-target;
  }

  /* Mobile widget optimizations */
  .mobile-widget {
    /* Ensure widgets are touch-friendly on mobile */
    @apply p-1;
  }

  .mobile-widget > * {
    /* Ensure all widget content respects mobile layout */
    height: 100%;
    width: 100%;
  }

  /* Mobile-specific responsive classes */
  @media (max-width: 768px) {
    .mobile-widget .grid {
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 0.5rem;
    }
    
    .mobile-widget .grid-cols-2 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .mobile-widget .grid-cols-3 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .mobile-widget .grid-cols-4 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    
    /* Increase touch targets */
    .mobile-widget button,
    .mobile-widget [role="button"] {
      min-height: 2.75rem;
      padding-left: 1rem;
      padding-right: 1rem;
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
    
    /* Optimize text sizes for mobile */
    .mobile-widget .text-xs {
      font-size: 0.875rem;
      line-height: 1.25rem;
    }
    
    .mobile-widget .text-sm {
      font-size: 1rem;
      line-height: 1.5rem;
    }
    
    /* Add proper spacing for cards */
    .mobile-widget .space-y-4 > * + * {
      margin-top: 0.75rem;
    }
    
    .mobile-widget .space-y-6 > * + * {
      margin-top: 1rem;
    }

    /* Mobile-specific widget padding */
    .mobile-widget .p-4 {
      padding: 0.75rem;
    }
    
    .mobile-widget .p-6 {
      padding: 1rem;
    }

    /* Ensure mobile cards have proper spacing */
    .mobile-widget .card-content {
      padding: 1rem;
    }
  }

  /* Improve touch responsiveness */
  button, [role="button"] {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile-specific CRT effects (lighter for performance) */
  @media (max-width: 768px) {
    /* Reduce scanline intensity and frequency for mobile performance */
    .crt-screen::before {
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 4px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.5)) 4px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.5)) 8px
      );
    }
    
    /* Reduce glow effects on mobile to improve performance */
    .crt-glow {
      text-shadow: 
        0 0 calc(var(--glow-size) * 0.8) hsl(var(--primary)),
        0 0 calc(var(--glow-size) * 1.5) hsl(var(--primary));
    }
    
    /* Simplify icon glow effects on mobile */
    .icon-glow {
      filter: drop-shadow(0 0 calc(var(--glow-size) * 0.8) currentColor);
    }
    
    /* Disable hover effects on mobile (touch devices) */
    button:hover svg, [role="button"]:hover svg, .cursor-pointer:hover svg {
      filter: none;
      transform: none;
    }
    
    /* Disable flicker animation on mobile for better performance */
    .crt-flicker {
      animation: none;
    }
    
    /* Optimize gradients for mobile */
    .crt-screen {
      background: hsl(var(--theme-hue) 100% 3%);
    }
  }

  /* Accessibility: Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    /* Disable all animations and transitions for users who prefer reduced motion */
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
    
    /* Remove CRT effects for users with motion sensitivity */
    .crt-screen::before {
      display: none;
    }
    
    .crt-flicker {
      animation: none;
    }
    
    /* Simplify text glow for reduced motion */
    .crt-glow {
      text-shadow: 0 0 calc(var(--glow-size) * 0.5) hsl(var(--primary));
    }
    
    /* Disable boot sequence animation */
    .boot-sequence {
      animation: none;
      opacity: 1;
      transform: scale(1);
    }
  }

  /* High contrast mode optimizations */
  @media (prefers-contrast: high) {
    .crt-screen::before {
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 1.5)) 2px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 1.5)) 4px
      );
    }
  }

  /* Performance mode for low-end devices */
  @media (max-width: 768px) and (max-resolution: 150dpi) {
    /* Ultra-minimal effects for low-DPI mobile devices */
    .crt-screen::before {
      display: none;
    }
    
    .crt-glow, .icon-glow {
      text-shadow: none;
      filter: none;
    }
    
    /* Use solid backgrounds instead of gradients */
    .crt-screen {
      background: hsl(var(--background));
    }
  }

  /* Responsive Typography Classes */
  .text-responsive-xs { font-size: var(--text-xs); line-height: var(--line-height-normal); }
  .text-responsive-sm { font-size: var(--text-sm); line-height: var(--line-height-normal); }
  .text-responsive-base { font-size: var(--text-base); line-height: var(--line-height-normal); }
  .text-responsive-lg { font-size: var(--text-lg); line-height: var(--line-height-normal); }
  .text-responsive-xl { font-size: var(--text-xl); line-height: var(--line-height-normal); }
  .text-responsive-2xl { font-size: var(--text-2xl); line-height: var(--line-height-tight); }
  .text-responsive-3xl { font-size: var(--text-3xl); line-height: var(--line-height-tight); }

  /* Container-based responsive text sizing */
  @container (min-width: 320px) {
    .container-responsive {
      --text-scale-factor: 0.9;
    }
  }

  @container (min-width: 480px) {
    .container-responsive {
      --text-scale-factor: 1.0;
    }
  }

  @container (min-width: 640px) {
    .container-responsive {
      --text-scale-factor: 1.1;
    }
  }

  @container (min-width: 800px) {
    .container-responsive {
      --text-scale-factor: 1.2;
    }
  }

  /* Widget-specific responsive containers */
  .widget-container {
    container-type: inline-size;
    @apply container-responsive;
  }

  .widget-text-auto {
    font-size: clamp(0.75rem, 3cqw, 1.25rem);
    line-height: var(--line-height-normal);
  }

  .widget-title-auto {
    font-size: clamp(1rem, 4cqw, 1.5rem);
    line-height: var(--line-height-tight);
  }

  .widget-header-auto {
    font-size: clamp(1.25rem, 5cqw, 2rem);
    line-height: var(--line-height-tight);
  }

  /* Performance optimizations */
  .will-change-transform { will-change: transform; }
  .will-change-opacity { will-change: opacity; }
  .will-change-auto { will-change: auto; }
  
  /* GPU acceleration hints for smooth animations */
  .gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }
  
  /* Mobile-specific performance optimizations */
  @media (max-width: 768px) {
    /* Force hardware acceleration for key elements */
    .crt-screen, .mobile-widget, .sidebar {
      transform: translateZ(0);
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }
    
    /* Optimize scrolling performance */
    .overflow-auto, .overflow-y-auto {
      -webkit-overflow-scrolling: touch;
    }
    
    /* Reduce repaint areas */
    button, [role="button"] {
      isolation: isolate;
    }
  }

  /* Mobile scrollbar hide utility */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari, Opera */
  }

  /* Performance-based effect controls */
  
  /* No effects mode (for accessibility or very low-end devices) */
  .no-effects .crt-screen::before,
  .no-effects .crt-glow,
  .no-effects .icon-glow,
  .no-effects .crt-flicker {
    display: none !important;
    text-shadow: none !important;
    filter: none !important;
    animation: none !important;
  }
  
  /* Minimal effects mode (for low-end mobile devices) */
  .minimal-effects .crt-screen::before {
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 6px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.3)) 6px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.3)) 12px
    );
  }
  
  .minimal-effects .crt-glow {
    text-shadow: 0 0 calc(var(--glow-size) * 0.5) hsl(var(--primary));
  }
  
  .minimal-effects .icon-glow {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 0.5) currentColor);
  }
  
  .minimal-effects .crt-flicker {
    animation: none;
  }
  
  /* Reduced effects mode (for standard mobile devices) */
  .reduced-effects .crt-screen::before {
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 4px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.6)) 4px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.6)) 8px
    );
  }
  
  .reduced-effects .crt-glow {
    text-shadow: 
      0 0 calc(var(--glow-size) * 0.7) hsl(var(--primary)),
      0 0 calc(var(--glow-size) * 1.2) hsl(var(--primary));
  }
  
  .reduced-effects .icon-glow {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 0.7) currentColor);
  }
  
  /* Low-end device optimizations */
  .low-end-device * {
    will-change: auto !important;
  }
  
  .low-end-device .crt-screen {
    background: hsl(var(--background)) !important;
  }
  
  /* Force hardware acceleration only when beneficial */
  .full-effects .gpu-accelerated,
  .reduced-effects .gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
  }
  
  .minimal-effects .gpu-accelerated,
  .no-effects .gpu-accelerated {
    transform: none;
    backface-visibility: visible;
  }
}