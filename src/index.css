/* Import Google Fonts first */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323:wght@400&family=Share+Tech+Mono:wght@400&display=swap');

/* Import modern CSS architecture */
@import "./styles/modern-css-architecture.css";
@import "./styles/widget-system.css";
@import "./styles/crt.css";
@import "./styles/accessibility.css";

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* PipBoy-Inspired CRT Color Scheme */
    --theme-hue: 120; /* Emerald Green Base */
    
    /* Core CRT Colors - Exact PipBoy Palette */
    --crt-emerald-primary: 120 100% 50%;      /* Main CRT green */
    --crt-emerald-glow: 120 100% 65%;         /* Bright glow variant */
    --crt-emerald-dim: 120 100% 35%;          /* Dimmed variant */
    --crt-emerald-muted: 120 40% 60%;         /* Secondary text */
    --crt-emerald-border: 120 30% 25%;        /* Subtle borders */
    
    --crt-background: 200 20% 8%;             /* Deep black with blue tint */
    --crt-panel: 200 15% 12%;                 /* Dark panel background */
    --crt-amber: 45 100% 60%;                 /* Warning/accent amber */
    --crt-cyan: 200 100% 60%;                 /* Special highlights */
    --crt-red: 0 100% 60%;                    /* Alert/error states */
    
    /* Base Colors using CRT palette */
    --background: var(--crt-background);
    --foreground: var(--crt-emerald-glow);
    
    --card: var(--crt-panel);
    --card-foreground: var(--crt-emerald-glow);
    
    --popover: var(--crt-panel);
    --popover-foreground: var(--crt-emerald-glow);
    
    --primary: var(--crt-emerald-primary);
    --primary-foreground: var(--crt-background);
    
    --secondary: var(--crt-emerald-border);
    --secondary-foreground: var(--crt-emerald-glow);
    
    --muted: var(--crt-panel);
    --muted-foreground: var(--crt-emerald-muted);
    
    --accent: var(--crt-emerald-glow);
    --accent-foreground: var(--crt-background);
    
    --destructive: var(--crt-red);
    --destructive-foreground: 0 0% 100%;
    
    --border: var(--crt-emerald-border);
    --input: var(--crt-panel);
    --ring: var(--crt-emerald-primary);
    
    --radius: 1rem;                /* Rounded corners for modern feel */
    
    /* Enhanced CRT Effects */
    --scanline-opacity: 0.08;
    --flicker-intensity: 0.97;
    --glow-size: 3px;
    --panel-glow: 0 0 20px hsl(var(--crt-emerald-primary) / 0.15);
    --text-glow: 0 0 8px hsl(var(--crt-emerald-primary)), 0 0 16px hsl(var(--crt-emerald-primary) / 0.5);
    --border-glow: 0 0 4px hsl(var(--crt-emerald-primary) / 0.3), inset 0 0 4px hsl(var(--crt-emerald-primary) / 0.1);
    
    /* Enhanced PipBoy Gradients */
    --gradient-crt: linear-gradient(180deg, 
      hsl(var(--crt-panel)), 
      hsl(var(--crt-background)), 
      hsl(var(--crt-panel)));
    --gradient-screen: radial-gradient(ellipse at center,
      hsl(var(--crt-panel)) 0%,
      hsl(var(--crt-background)) 100%);
    --gradient-sliding: linear-gradient(90deg,
      transparent 0%,
      hsl(var(--crt-emerald-primary) / 0.2) 30%,
      hsl(var(--crt-emerald-glow) / 0.4) 50%,
      hsl(var(--crt-emerald-primary) / 0.2) 70%,
      transparent 100%);
      
    /* Sidebar colors updated to match PipBoy scheme */
    --sidebar-background: var(--crt-panel);
    --sidebar-foreground: var(--crt-emerald-glow);
    --sidebar-primary: var(--crt-emerald-primary);
    --sidebar-primary-foreground: var(--crt-background);
    --sidebar-accent: var(--crt-emerald-border);
    --sidebar-accent-foreground: var(--crt-emerald-glow);
    --sidebar-border: var(--crt-emerald-border);
    --sidebar-ring: var(--crt-emerald-primary);

    /* Animations */
    --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

    /* Enhanced Responsive Typography System */
    --text-scale-factor: clamp(0.85, 2.5cqw + 0.5rem, 1.25);
    --text-responsive-xs: clamp(0.75rem, 1.5cqw + 0.5rem, 0.875rem);
    --text-responsive-sm: clamp(0.875rem, 2cqw + 0.5rem, 1rem);
    --text-responsive-md: clamp(1rem, 2.5cqw + 0.5rem, 1.125rem);
    --text-responsive-lg: clamp(1.125rem, 3cqw + 0.5rem, 1.25rem);
    --text-responsive-xl: clamp(1.25rem, 3.5cqw + 0.5rem, 1.5rem);
    --text-responsive-2xl: clamp(1.5rem, 4cqw + 0.5rem, 1.875rem);
    --text-responsive-3xl: clamp(1.875rem, 5cqw + 0.5rem, 2.25rem);

    /* Enhanced Spacing System */
    --space-xs: clamp(0.25rem, 1cqw, 0.5rem);
    --space-sm: clamp(0.5rem, 1.5cqw, 0.75rem);
    --space-md: clamp(0.75rem, 2cqw, 1rem);
    --space-lg: clamp(1rem, 2.5cqw, 1.5rem);
    --space-xl: clamp(1.5rem, 3cqw, 2rem);
    --space-2xl: clamp(2rem, 4cqw, 3rem);
    --space-3xl: clamp(3rem, 5cqw, 4rem);

    /* Container System */
    --container-xs: 20rem;
    --container-sm: 24rem;
    --container-md: 28rem;
    --container-lg: 32rem;
    --container-xl: 36rem;
    --container-2xl: 42rem;
    --container-3xl: 48rem;

    /* Border Radius System */
    --radius-xs: 0.125rem;
    --radius-sm: 0.25rem;
    --radius-md: 0.375rem;
    --radius-lg: 0.5rem;
    --radius-xl: 0.75rem;
    --radius-2xl: 1rem;
    --radius-full: 9999px;

    /* Enhanced Shadow System */
    --shadow-xs: 0 1px 2px 0 hsl(var(--crt-background) / 0.5);
    --shadow-sm: 0 1px 3px 0 hsl(var(--crt-background) / 0.5), 0 1px 2px -1px hsl(var(--crt-background) / 0.5);
    --shadow-md: 0 4px 6px -1px hsl(var(--crt-background) / 0.5), 0 2px 4px -2px hsl(var(--crt-background) / 0.5);
    --shadow-lg: 0 10px 15px -3px hsl(var(--crt-background) / 0.5), 0 4px 6px -4px hsl(var(--crt-background) / 0.5);
    --shadow-xl: 0 20px 25px -5px hsl(var(--crt-background) / 0.5), 0 8px 10px -6px hsl(var(--crt-background) / 0.5);

    /* Widget System Shadows */
    --widget-shadow: 0 4px 12px hsl(var(--crt-emerald-primary) / 0.15), 0 0 0 1px hsl(var(--crt-emerald-border) / 0.8);
    --widget-shadow-hover: 0 8px 24px hsl(var(--crt-emerald-primary) / 0.25), 0 0 0 1px hsl(var(--crt-emerald-primary) / 0.5);
    --widget-shadow-focus: 0 0 0 2px hsl(var(--crt-emerald-primary) / 0.8), 0 8px 24px hsl(var(--crt-emerald-primary) / 0.25);

    /* Animation Timing System */
    --duration-instant: 0ms;
    --duration-fast: 150ms;
    --duration-base: 250ms;
    --duration-slow: 350ms;
    --duration-slower: 500ms;

    /* Enhanced Easing Functions */
    --easing-linear: linear;
    --easing-smooth: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --easing-emphasis: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    --easing-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);

    /* Widget System Properties */
    --widget-accent: var(--crt-emerald-primary);
    --widget-text: var(--crt-emerald-glow);
    --widget-muted: var(--crt-emerald-muted);
    --widget-border: var(--crt-emerald-border);
    --widget-collapsed-block-size: 3rem;

    /* CRT-aware line height for better readability */
    --line-height-tight: 1.1;
    --line-height-normal: 1.3;
    --line-height-relaxed: 1.5;
  }

  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground font-mono;
    overflow: hidden; /* Prevent scrollbars for immersive feel */
    /* Mobile optimizations */
    -webkit-user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* CRT Screen Effects */
  .crt-screen {
    position: relative;
    background: var(--gradient-screen);
    overflow: hidden;
  }

  .crt-screen::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      hsla(var(--theme-hue), 100%, 50%, var(--scanline-opacity)) 2px,
      hsla(var(--theme-hue), 100%, 50%, var(--scanline-opacity)) 4px
    );
    pointer-events: none;
    z-index: 1000;
  }

  .crt-glow {
    text-shadow: var(--text-glow);
  }

  /* PipBoy Enhanced Typography Effects */
  .pipboy-heading {
    font-family: 'Orbitron', monospace;
    font-weight: 700;
    text-shadow: var(--text-glow);
    color: hsl(var(--crt-emerald-glow));
    letter-spacing: 0.05em;
  }

  .pipboy-title {
    font-family: 'Orbitron', monospace;
    font-weight: 400;
    text-shadow: 
      0 0 4px hsl(var(--crt-emerald-primary)),
      0 0 8px hsl(var(--crt-emerald-primary) / 0.3);
    color: hsl(var(--crt-emerald-primary));
  }

  .terminal-text {
    font-family: 'Share Tech Mono', monospace;
    text-shadow: 0 0 2px hsl(var(--crt-emerald-primary) / 0.5);
  }

  /* Terminal Blink Effect */
  .terminal-cursor::after {
    content: 'â–ˆ';
    animation: blink 1s infinite;
    color: hsl(var(--crt-emerald-glow));
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  /* Enhanced Panel Glow Effects */
  .pipboy-panel {
    background: hsl(var(--crt-panel));
    border: 1px solid hsl(var(--crt-emerald-border));
    box-shadow: var(--panel-glow);
    position: relative;
    overflow: hidden;
  }

  .pipboy-panel::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, 
      transparent 30%, 
      hsl(var(--crt-emerald-primary) / 0.1) 50%, 
      transparent 70%);
    z-index: -1;
    border-radius: inherit;
  }

  /* Border Illumination */
  .border-glow {
    border: 1px solid hsl(var(--crt-emerald-border));
    box-shadow: var(--border-glow);
  }

  .border-glow:hover {
    border-color: hsl(var(--crt-emerald-primary));
    box-shadow: 
      0 0 8px hsl(var(--crt-emerald-primary) / 0.5),
      inset 0 0 8px hsl(var(--crt-emerald-primary) / 0.1);
  }

  /* Hover Enhancement with Sliding Gradient */
  .pipboy-hover {
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .pipboy-hover::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--gradient-sliding);
    transition: left 0.5s ease;
    z-index: 1;
    pointer-events: none;
  }

  .pipboy-hover:hover::before {
    left: 100%;
  }

  .pipboy-hover:hover {
    background-color: hsl(var(--crt-emerald-border) / 0.2);
    box-shadow: 
      var(--panel-glow),
      inset 0 0 20px hsl(var(--crt-emerald-primary) / 0.1);
  }

  /* Enhanced Flicker Animation */
  .pipboy-flicker {
    animation: pipboyFlicker 3s infinite ease-in-out;
  }

  @keyframes pipboyFlicker {
    0%, 96%, 100% { opacity: 1; }
    97% { opacity: 0.92; }
    98% { opacity: 1; }
    99% { opacity: 0.96; }
  }

  /* Icon Color Utilities */
  .icon-primary {
    color: hsl(var(--primary));
  }

  .icon-secondary {
    color: hsl(var(--secondary-foreground));
  }

  .icon-accent {
    color: hsl(var(--accent));
  }

  .icon-muted {
    color: hsl(var(--muted-foreground));
  }

  .icon-destructive {
    color: hsl(var(--destructive));
  }

  /* Monochrome System - Theme-aware icons */
  .icon-monochrome,
  .lucide,
  svg[class*="lucide"],
  button svg,
  .icon {
    filter: 
      sepia(100%) 
      hue-rotate(calc(var(--theme-hue, 120) * 1deg)) 
      saturate(1.2) 
      brightness(0.9) 
      contrast(1.1)
      drop-shadow(0 0 2px hsl(var(--primary) / 0.3)) !important;
    transition: filter 0.3s ease;
  }

  .icon-monochrome:hover,
  .lucide:hover,
  svg[class*="lucide"]:hover,
  button:hover svg,
  .icon:hover {
    filter: 
      sepia(100%) 
      hue-rotate(calc(var(--theme-hue, 120) * 1deg)) 
      saturate(1.4) 
      brightness(1.1) 
      contrast(1.2)
      drop-shadow(0 0 4px hsl(var(--primary) / 0.5)) !important;
  }

  /* Monochrome images */
  .image-monochrome {
    filter: 
      sepia(50%) 
      hue-rotate(calc(var(--theme-hue, 120) * 1deg)) 
      saturate(0.8) 
      brightness(0.9)
      contrast(1.1);
    transition: filter 0.3s ease;
  }

  /* Force monochrome on specific icon containers */
  .widget-header svg,
  .tab-item svg,
  .sidebar svg,
  [data-icon] svg {
    filter: 
      sepia(100%) 
      hue-rotate(calc(var(--theme-hue, 120) * 1deg)) 
      saturate(1.2) 
      brightness(0.9) 
      contrast(1.1)
      drop-shadow(0 0 2px hsl(var(--primary) / 0.3)) !important;
  }

  /* Icon CRT Glow Effects */
  .icon-glow {
    filter: drop-shadow(0 0 var(--glow-size) currentColor) 
            drop-shadow(0 0 calc(var(--glow-size) * 2) currentColor);
  }

  /* All icons get CRT styling by default */
  svg {
    transition: all 0.2s ease;
  }

  /* Hover effects for interactive icons */
  button svg, [role="button"] svg, .cursor-pointer svg {
    transition: all 0.2s ease;
  }

  button:hover svg, [role="button"]:hover svg, .cursor-pointer:hover svg {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 1.5) currentColor);
    transform: scale(1.05);
  }

  .crt-flicker {
    animation: flicker 0.15s infinite linear alternate;
  }

  @keyframes flicker {
    0%, 100% { opacity: 1; }
    50% { opacity: var(--flicker-intensity); }
  }

  /* Enhanced PipBoy Scrollbar Styling */
  /* Webkit browsers (Chrome, Safari, Edge) */
  ::-webkit-scrollbar {
    width: 14px;
    height: 14px;
  }

  ::-webkit-scrollbar-track {
    background: hsl(var(--crt-background));
    border: 1px solid hsl(var(--crt-emerald-border));
    border-radius: 0;
    box-shadow: inset 0 0 8px hsl(var(--crt-emerald-primary) / 0.1);
  }

  ::-webkit-scrollbar-thumb {
    background: linear-gradient(
      180deg,
      hsl(var(--crt-emerald-primary) / 0.8) 0%,
      hsl(var(--crt-emerald-primary) / 0.6) 50%,
      hsl(var(--crt-emerald-primary) / 0.8) 100%
    );
    border-radius: 0;
    border: 1px solid hsl(var(--crt-emerald-primary) / 0.5);
    box-shadow: 
      0 0 6px hsl(var(--crt-emerald-primary) / 0.4),
      inset 0 0 4px hsl(var(--crt-emerald-primary) / 0.2);
    transition: all 0.3s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(
      180deg,
      hsl(var(--crt-emerald-glow)) 0%,
      hsl(var(--crt-emerald-primary)) 50%,
      hsl(var(--crt-emerald-glow)) 100%
    );
    box-shadow: 
      0 0 12px hsl(var(--crt-emerald-primary) / 0.6),
      inset 0 0 8px hsl(var(--crt-emerald-primary) / 0.3);
  }

  ::-webkit-scrollbar-thumb:active {
    background: hsl(var(--crt-emerald-glow));
    box-shadow: 
      0 0 16px hsl(var(--crt-emerald-primary)),
      inset 0 0 12px hsl(var(--crt-emerald-primary) / 0.4);
  }

  ::-webkit-scrollbar-corner {
    background: hsl(var(--crt-background));
    border: 1px solid hsl(var(--crt-emerald-border));
  }

  /* Firefox scrollbar styling */
  * {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--crt-emerald-primary) / 0.8) hsl(var(--crt-background));
  }

  /* Custom scrollbar for specific containers with CRT theme */
  .crt-scrollbar::-webkit-scrollbar {
    width: 14px;
  }

  .crt-scrollbar::-webkit-scrollbar-track {
    background: hsl(var(--background));
    border: 1px solid hsl(var(--primary) / 0.3);
    border-radius: 0;
    box-shadow: inset 0 0 6px hsl(var(--primary) / 0.1);
  }

  .crt-scrollbar::-webkit-scrollbar-thumb {
    background: linear-gradient(
      180deg,
      hsl(var(--primary) / 0.8) 0%,
      hsl(var(--primary) / 0.6) 50%,
      hsl(var(--primary) / 0.8) 100%
    );
    border-radius: 0;
    border: 1px solid hsl(var(--primary) / 0.5);
    box-shadow: 
      0 0 4px hsl(var(--primary) / 0.3),
      inset 0 0 2px hsl(var(--primary) / 0.2);
  }

  .crt-scrollbar::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(
      180deg,
      hsl(var(--primary)) 0%,
      hsl(var(--primary) / 0.8) 50%,
      hsl(var(--primary)) 100%
    );
    box-shadow: 
      0 0 8px hsl(var(--primary) / 0.5),
      inset 0 0 4px hsl(var(--primary) / 0.3);
  }
  /* Boot sequence animation */
  .boot-sequence {
    animation: bootUp 2s ease-out;
  }

  @keyframes bootUp {
    0% {
      opacity: 0;
      transform: scale(0.8);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.9);
    }
    100% {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Mobile touch optimizations */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
    position: relative;
  }

  .mobile-nav {
    @apply touch-target;
  }

  /* Mobile widget optimizations */
  .mobile-widget {
    /* Ensure widgets are touch-friendly on mobile */
    @apply p-1;
  }

  .mobile-widget > * {
    /* Ensure all widget content respects mobile layout */
    height: 100%;
    width: 100%;
  }

  /* Mobile-specific responsive classes */
  @media (max-width: 768px) {
    .mobile-widget .grid {
      grid-template-columns: repeat(1, minmax(0, 1fr));
      gap: 0.5rem;
    }
    
    .mobile-widget .grid-cols-2 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .mobile-widget .grid-cols-3 {
      grid-template-columns: repeat(1, minmax(0, 1fr));
    }
    
    .mobile-widget .grid-cols-4 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    
    /* Increase touch targets */
    .mobile-widget button,
    .mobile-widget [role="button"] {
      min-height: 2.75rem;
      padding-left: 1rem;
      padding-right: 1rem;
      padding-top: 0.5rem;
      padding-bottom: 0.5rem;
    }
    
    /* Optimize text sizes for mobile */
    .mobile-widget .text-xs {
      font-size: 0.875rem;
      line-height: 1.25rem;
    }
    
    .mobile-widget .text-sm {
      font-size: 1rem;
      line-height: 1.5rem;
    }
    
    /* Add proper spacing for cards */
    .mobile-widget .space-y-4 > * + * {
      margin-top: 0.75rem;
    }
    
    .mobile-widget .space-y-6 > * + * {
      margin-top: 1rem;
    }

    /* Mobile-specific widget padding */
    .mobile-widget .p-4 {
      padding: 0.75rem;
    }
    
    .mobile-widget .p-6 {
      padding: 1rem;
    }

    /* Ensure mobile cards have proper spacing */
    .mobile-widget .card-content {
      padding: 1rem;
    }
  }

  /* Improve touch responsiveness */
  button, [role="button"] {
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* Mobile-specific CRT effects (lighter for performance) */
  @media (max-width: 768px) {
    /* Reduce scanline intensity and frequency for mobile performance */
    .crt-screen::before {
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 4px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.5)) 4px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.5)) 8px
      );
    }
    
    /* Reduce glow effects on mobile to improve performance */
    .crt-glow {
      text-shadow: 
        0 0 calc(var(--glow-size) * 0.8) hsl(var(--primary)),
        0 0 calc(var(--glow-size) * 1.5) hsl(var(--primary));
    }
    
    /* Simplify icon glow effects on mobile */
    .icon-glow {
      filter: drop-shadow(0 0 calc(var(--glow-size) * 0.8) currentColor);
    }
    
    /* Disable hover effects on mobile (touch devices) */
    button:hover svg, [role="button"]:hover svg, .cursor-pointer:hover svg {
      filter: none;
      transform: none;
    }
    
    /* Disable flicker animation on mobile for better performance */
    .crt-flicker {
      animation: none;
    }
    
    /* Optimize gradients for mobile */
    .crt-screen {
      background: hsl(var(--theme-hue) 100% 3%);
    }
  }

  /* Accessibility: Respect user's motion preferences */
  @media (prefers-reduced-motion: reduce) {
    /* Disable all animations and transitions for users who prefer reduced motion */
    *, *::before, *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
    
    /* Remove CRT effects for users with motion sensitivity */
    .crt-screen::before {
      display: none;
    }
    
    .crt-flicker {
      animation: none;
    }
    
    /* Simplify text glow for reduced motion */
    .crt-glow {
      text-shadow: 0 0 calc(var(--glow-size) * 0.5) hsl(var(--primary));
    }
    
    /* Disable boot sequence animation */
    .boot-sequence {
      animation: none;
      opacity: 1;
      transform: scale(1);
    }
  }

  /* Retro button styling for consistency */
  .retro-button {
    @apply transition-all duration-200 hover:shadow-lg rounded-none border-2 font-bold tracking-wider;
    border: 1px solid hsl(var(--border));
    background: linear-gradient(180deg, hsl(var(--card)), hsl(var(--background)));
  }
  
  .retro-button:hover {
    background: linear-gradient(180deg, hsl(var(--accent) / 0.2), hsl(var(--card)));
    box-shadow: 0 0 8px hsl(var(--primary) / 0.3);
  }

  /* High contrast mode optimizations */
  @media (prefers-contrast: high) {
    .crt-screen::before {
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 1.5)) 2px,
        hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 1.5)) 4px
      );
    }
  }

  /* Performance mode for low-end devices */
  @media (max-width: 768px) and (max-resolution: 150dpi) {
    /* Ultra-minimal effects for low-DPI mobile devices */
    .crt-screen::before {
      display: none;
    }
    
    .crt-glow, .icon-glow {
      text-shadow: none;
      filter: none;
    }
    
    /* Use solid backgrounds instead of gradients */
    .crt-screen {
      background: hsl(var(--background));
    }
  }

  /* Responsive Typography Classes */
  .text-responsive-xs { font-size: var(--text-xs); line-height: var(--line-height-normal); }
  .text-responsive-sm { font-size: var(--text-sm); line-height: var(--line-height-normal); }
  .text-responsive-base { font-size: var(--text-base); line-height: var(--line-height-normal); }
  .text-responsive-lg { font-size: var(--text-lg); line-height: var(--line-height-normal); }
  .text-responsive-xl { font-size: var(--text-xl); line-height: var(--line-height-normal); }
  .text-responsive-2xl { font-size: var(--text-2xl); line-height: var(--line-height-tight); }
  .text-responsive-3xl { font-size: var(--text-3xl); line-height: var(--line-height-tight); }

  /* Container-based responsive text sizing */
  @container (min-width: 320px) {
    .container-responsive {
      --text-scale-factor: 0.9;
    }
  }

  @container (min-width: 480px) {
    .container-responsive {
      --text-scale-factor: 1.0;
    }
  }

  @container (min-width: 640px) {
    .container-responsive {
      --text-scale-factor: 1.1;
    }
  }

  @container (min-width: 800px) {
    .container-responsive {
      --text-scale-factor: 1.2;
    }
  }

  /* Widget-specific responsive containers */
  .widget-container {
    container-type: inline-size;
    @apply container-responsive;
  }

  /* Clean widget collapse styles - simplified from complex layered system */
  .widget-collapsed {
    height: 48px !important;
    min-height: 48px !important;
    max-height: 48px !important;
    overflow: hidden !important;
  }

  .widget-expanded {
    height: auto;
    min-height: auto;
    max-height: none;
    overflow: visible;
  }

  .widget-text-auto {
    font-size: clamp(0.75rem, 3cqw, 1.25rem);
    line-height: var(--line-height-normal);
  }

  .widget-title-auto {
    font-size: clamp(1rem, 4cqw, 1.5rem);
    line-height: var(--line-height-tight);
  }

  .widget-header-auto {
    font-size: clamp(1.25rem, 5cqw, 2rem);
    line-height: var(--line-height-tight);
  }

  /* Performance optimizations */
  .will-change-transform { will-change: transform; }
  .will-change-opacity { will-change: opacity; }
  .will-change-auto { will-change: auto; }
  
  /* GPU acceleration hints for smooth animations */
  .gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }
  
  /* Mobile-specific performance optimizations */
  @media (max-width: 768px) {
    /* Force hardware acceleration for key elements */
    .crt-screen, .mobile-widget, .sidebar {
      transform: translateZ(0);
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }
    
    /* Optimize scrolling performance */
    .overflow-auto, .overflow-y-auto {
      -webkit-overflow-scrolling: touch;
    }
    
    /* Reduce repaint areas */
    button, [role="button"] {
      isolation: isolate;
    }
  }

  /* Mobile scrollbar hide utility */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari, Opera */
  }

  /* Performance-based effect controls */
  
  /* No effects mode (for accessibility or very low-end devices) */
  .no-effects .crt-screen::before,
  .no-effects .crt-glow,
  .no-effects .icon-glow,
  .no-effects .crt-flicker {
    display: none !important;
    text-shadow: none !important;
    filter: none !important;
    animation: none !important;
  }
  
  /* Minimal effects mode (for low-end mobile devices) */
  .minimal-effects .crt-screen::before {
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 6px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.3)) 6px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.3)) 12px
    );
  }
  
  .minimal-effects .crt-glow {
    text-shadow: 0 0 calc(var(--glow-size) * 0.5) hsl(var(--primary));
  }
  
  .minimal-effects .icon-glow {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 0.5) currentColor);
  }
  
  .minimal-effects .crt-flicker {
    animation: none;
  }
  
  /* Reduced effects mode (for standard mobile devices) */
  .reduced-effects .crt-screen::before {
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 4px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.6)) 4px,
      hsla(var(--theme-hue), 100%, 50%, calc(var(--scanline-opacity) * 0.6)) 8px
    );
  }
  
  .reduced-effects .crt-glow {
    text-shadow: 
      0 0 calc(var(--glow-size) * 0.7) hsl(var(--primary)),
      0 0 calc(var(--glow-size) * 1.2) hsl(var(--primary));
  }
  
  .reduced-effects .icon-glow {
    filter: drop-shadow(0 0 calc(var(--glow-size) * 0.7) currentColor);
  }
  
  /* Low-end device optimizations */
  .low-end-device * {
    will-change: auto !important;
  }
  
  .low-end-device .crt-screen {
    background: hsl(var(--background)) !important;
  }
  
  /* Force hardware acceleration only when beneficial */
  .full-effects .gpu-accelerated,
  .reduced-effects .gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
  }
  
  .minimal-effects .gpu-accelerated,
  .no-effects .gpu-accelerated {
    transform: none;
    backface-visibility: visible;
  }
}